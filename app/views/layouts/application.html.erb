<!DOCTYPE html>
<html>
<head>
  <title>Tocoe</title>
  <%= stylesheet_link_tag    'application', media: 'all', 'data-turbolinks-track' => true %>
  <%= javascript_include_tag 'application', 'data-turbolinks-track' => true %>
  <%= csrf_meta_tags %>
</head>
<body>
<div id="main-container" class="container-fluid">
  <nav class="tocoe-navbar">
    <div class="navbar-container">
      <div class="navbar-brand">
        <%= link_to root_path, class: 'tocoe-logo-link' do %>
          <%= image_tag 'tocoe-logo.svg', alt: 'ToCoE', class: 'tocoe-logo' %>
        <% end %>
      </div>

      <% if user_signed_in? %>
        <ul class="navbar-menu">
          <li><%= link_to 'ðŸ  ' + t('common.nav.dashboard', default: 'Dashboard'), root_path, class: nav_link_class(root_path) %></li>
          <li><%= link_to 'ðŸ” ' + t('common.nav.search', default: 'Search'), publications_search_path, class: nav_link_class(publications_search_path) %></li>
          <li><%= link_to 'ðŸ“š ' + t('common.nav.tocs', default: 'TOCs'), tocs_path, class: nav_link_class(tocs_path) %></li>
          <li><%= link_to 'ðŸ·ï¸ ' + t('common.nav.subjects', default: 'Subject Headings'), dashboard_aboutness_path, class: nav_link_class(dashboard_aboutness_path) %></li>
          <li><%= link_to raw('<i class="glyphicon glyphicon-question-sign"></i> ' + t('common.nav.help', default: 'Help')), help_path, class: nav_link_class(help_path), title: t('common.nav.help_tooltip', default: 'Get help using ToCoE') %></li>
        </ul>
      <% end %>

      <% if user_signed_in? %>
        <div class="navbar-search">
          <%= form_tag search_tocs_path, method: :get, class: 'navbar-search-form' do %>
            <%= text_field_tag :search, params[:search],
                placeholder: t('common.nav.quick_search', default: 'Quick search...'),
                class: 'navbar-search-input' %>
            <%= button_tag type: 'submit', class: 'navbar-search-button' do %>
              <i class="glyphicon glyphicon-search"></i>
            <% end %>
          <% end %>
        </div>
      <% end %>

      <div class="navbar-user">
        <% if user_signed_in? %>
          <div class="user-menu-wrapper">
            <button class="user-menu-button" onclick="toggleUserMenu(event)">
              <div class="user-avatar"><%= current_user.email[0].upcase %></div>
              <span class="user-email"><%= current_user.email %></span>
              <span class="dropdown-arrow">â–¾</span>
            </button>
            <div class="user-dropdown" id="userDropdown">
              <%= link_to t('common.nav.my_tocs', default: 'My TOCs'), tocs_path, class: 'dropdown-item' %>
              <%= link_to t('common.nav.sign_out', default: 'Sign Out'), destroy_user_session_path, method: :delete, class: 'dropdown-item' %>
            </div>
          </div>
        <% elsif Devise.omniauth_configs[:google_oauth2] %>
          <%= link_to t('home.index.sign_in_button', default: 'Sign in with Google'), user_google_oauth2_omniauth_authorize_path, method: :post, class: 'btn btn-primary' %>
        <% end %>
      </div>
    </div>
  </nav>

  <%= render_breadcrumbs %>

  <%= render 'shared/flash_messages' %>

  <div class="main-content">
    <%= yield %>
  </div>

  <!-- Global loading overlay -->
  <div id="global-loading-overlay" class="loading-overlay" style="display: none; position: fixed;">
    <div class="loading-spinner">
      <div class="spinner spinner-lg"></div>
      <span class="loading-text"><%= t('common.loading', default: 'Loading...') %></span>
    </div>
  </div>

  <footer class="tocoe-footer">
    <div class="footer-content">
      <div class="footer-section">
        <h4><%= t('footer.about_title', default: 'About ToCoE') %></h4>
        <p><%= t('footer.about_description', default: 'Table of Contents of Everything - Creating CC0 public domain tables of contents through volunteer labor and linked open data.') %></p>
      </div>

      <div class="footer-section">
        <h4><%= t('footer.links_title', default: 'Links') %></h4>
        <ul class="footer-links">
          <li><a href="https://github.com/abartov/tocoe" target="_blank" rel="noopener">
            <%= t('footer.github', default: 'GitHub Repository') %> â†’
          </a></li>
          <li><a href="https://creativecommons.org/publicdomain/zero/1.0/" target="_blank" rel="noopener">
            <%= t('footer.license', default: 'CC0 1.0 Universal') %> â†’
          </a></li>
          <li><%= link_to t('footer.help', default: 'Help & Documentation'), help_path %></li>
        </ul>
      </div>

      <div class="footer-section">
        <h4><%= t('footer.contact_title', default: 'Contact') %></h4>
        <p><%= t('footer.contact_description', default: 'Questions or feedback?') %></p>
        <p>
          <a href="https://github.com/abartov/tocoe/issues" target="_blank" rel="noopener">
            <%= t('footer.report_issue', default: 'Report an Issue') %> â†’
          </a>
        </p>
      </div>
    </div>

    <div class="footer-bottom">
      <p>&copy; <%= Time.current.year %> ToCoE. <%= t('footer.cc0_notice', default: 'All content released under CC0 1.0 Universal.') %></p>
    </div>
  </footer>
</div>

<script>
function toggleUserMenu(event) {
  event.stopPropagation();
  var dropdown = document.getElementById('userDropdown');
  dropdown.classList.toggle('show');
}

// Close dropdown when clicking outside
document.addEventListener('click', function() {
  var dropdown = document.getElementById('userDropdown');
  if (dropdown && dropdown.classList.contains('show')) {
    dropdown.classList.remove('show');
  }
});

// Show loading overlay for Browse Scans links
document.addEventListener('DOMContentLoaded', function() {
  // Find all links that go to browse_scans paths
  var browseScansLinks = document.querySelectorAll('a[href*="/browse_scans"]');

  browseScansLinks.forEach(function(link) {
    link.addEventListener('click', function(e) {
      // Don't show loading for links that open in new tabs
      if (link.target === '_blank') {
        return;
      }

      // Show the loading overlay
      var overlay = document.getElementById('global-loading-overlay');
      if (overlay) {
        overlay.style.display = 'flex';
      }
    });
  });
});
</script>
</body>
</html>

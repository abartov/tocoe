<!DOCTYPE html>
<html>
<head>
  <title>Tocoe</title>
  <%= stylesheet_link_tag    'application', media: 'all', 'data-turbolinks-track' => true %>
  <%= javascript_include_tag 'application', 'data-turbolinks-track' => true %>
  <%= csrf_meta_tags %>
</head>
<body>
<div id="main-container" class="container-fluid">
  <nav class="tocoe-navbar">
    <div class="navbar-container">
      <div class="navbar-brand">
        <%= link_to root_path, class: 'tocoe-logo-link' do %>
          <%= image_tag 'tocoe-logo.svg', alt: 'ToCoE', class: 'tocoe-logo' %>
        <% end %>
      </div>

      <% if user_signed_in? %>
        <ul class="navbar-menu">
          <li><%= link_to 'ðŸ  ' + t('common.nav.dashboard', default: 'Dashboard'), root_path, class: nav_link_class(root_path) %></li>
          <li><%= link_to 'ðŸ” ' + t('common.nav.search', default: 'Search'), publications_search_path, class: nav_link_class(publications_search_path) %></li>
          <li><%= link_to 'ðŸ“š ' + t('common.nav.tocs', default: 'TOCs'), tocs_path, class: nav_link_class(tocs_path) %></li>
          <li><%= link_to raw('<i class="glyphicon glyphicon-question-sign"></i> ' + t('common.nav.help', default: 'Help')), help_path, class: nav_link_class(help_path), title: t('common.nav.help_tooltip', default: 'Get help using ToCoE') %></li>
        </ul>
      <% end %>

      <% if user_signed_in? %>
        <div class="navbar-search">
          <%= form_tag publications_search_path, method: :get, class: 'navbar-search-form' do %>
            <%= text_field_tag :search, params[:search],
                placeholder: t('common.nav.quick_search', default: 'Quick search...'),
                class: 'navbar-search-input' %>
            <%= button_tag type: 'submit', class: 'navbar-search-button' do %>
              <i class="glyphicon glyphicon-search"></i>
            <% end %>
          <% end %>
        </div>
      <% end %>

      <div class="navbar-user">
        <% if user_signed_in? %>
          <div class="user-menu-wrapper">
            <button class="user-menu-button" onclick="toggleUserMenu(event)">
              <div class="user-avatar"><%= current_user.email[0].upcase %></div>
              <span class="user-email"><%= current_user.email %></span>
              <span class="dropdown-arrow">â–¾</span>
            </button>
            <div class="user-dropdown" id="userDropdown">
              <%= link_to t('common.nav.my_tocs', default: 'My TOCs'), tocs_path, class: 'dropdown-item' %>
              <%= link_to t('common.nav.sign_out', default: 'Sign Out'), destroy_user_session_path, method: :delete, class: 'dropdown-item' %>
            </div>
          </div>
        <% elsif Devise.omniauth_configs[:google_oauth2] %>
          <%= link_to t('home.index.sign_in_button', default: 'Sign in with Google'), user_google_oauth2_omniauth_authorize_path, method: :post, class: 'btn btn-primary' %>
        <% end %>
      </div>
    </div>
  </nav>

  <div class="main-content">
    <%= yield %>
  </div>
</div>

<script>
function toggleUserMenu(event) {
  event.stopPropagation();
  var dropdown = document.getElementById('userDropdown');
  dropdown.classList.toggle('show');
}

// Close dropdown when clicking outside
document.addEventListener('click', function() {
  var dropdown = document.getElementById('userDropdown');
  if (dropdown && dropdown.classList.contains('show')) {
    dropdown.classList.remove('show');
  }
});
</script>
</body>
</html>

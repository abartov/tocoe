%h1= manifestation.title

-# Show aboutnesses for the main embodiment (sequence_number: nil)
- main_embodiment = manifestation.embodiments.find_by(sequence_number: nil)
-# Show authors of the publication
- if main_embodiment&.expression&.work&.creators&.any?
  %p.text-muted
    %strong= t('manifestations.show.authors_label', default: 'Authors:')
    = main_embodiment.expression.work.creators.map(&:name).join(', ')
- if main_embodiment
  .panel.panel-default
    .panel-heading
      %h3.panel-title Publication Subject Headings
    .panel-body
      - if main_embodiment.aboutnesses.any?
        %ul.list-unstyled
          - main_embodiment.aboutnesses.each do |aboutness|
            %li
              %span.label.label-info= aboutness.source_name
              = aboutness.subject_heading_label
              %small.text-muted
                = link_to aboutness.subject_heading_uri, aboutness.subject_heading_uri, target: '_blank'
      - else
        %p.text-muted No subject headings assigned yet.
      %p
        = link_to 'Manage Subject Headings', embodiment_aboutnesses_path(main_embodiment), class: 'btn btn-sm btn-primary'

%h2 Table of Contents
%ol
  - manifestation.embodiments.order(sequence_number: :asc).each do |emb|
    - next if emb.sequence_number.nil? # title of aggregating expression already provided in manifestation
    - parent_expression = emb.expression.container_expressions.first
    %li
      - unless parent_expression.nil? || parent_expression.container_expressions.empty?
        = '-->'
      = emb.expression.title
      - if emb.expression.work&.creators&.any?
        %span.text-muted{style: 'margin-left: 0.5rem;'}
          = "â€” #{emb.expression.work.creators.map(&:name).join(', ')}"
      - entry_aboutnesses = emb.aboutnesses
      .panel.panel-default.panel-subject-headings
        .panel-heading
          %h4.panel-title Subject Headings for this Work
        .panel-body
          - if entry_aboutnesses.any?
            %ul.list-unstyled
              - entry_aboutnesses.each do |aboutness|
                %li
                  %span.label.label-info= aboutness.source_name
                  = aboutness.subject_heading_label
                  %small.text-muted
                    = link_to aboutness.subject_heading_uri, aboutness.subject_heading_uri, target: '_blank'
          - else
            %p.text-muted No subject headings assigned yet for this work.
          %p
            = link_to 'Manage Subject Headings for this work', embodiment_aboutnesses_path(emb), class: 'btn btn-sm btn-primary'


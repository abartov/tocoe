.row
  #main{ class: 'col-xs-7'}
    = form_for @toc do |f|
      - if @toc.errors.any?
        #error_explanation
          %h2= "#{pluralize(@toc.errors.count, "error")} prohibited this toc from being saved:"
          %ul
            - @toc.errors.full_messages.each do |msg|
              %li= msg
      %table{class: 'table'}
        %tr
          .field
            %td= f.label 'Book URI'
            %td= f.text_field :book_uri
        %tr
          .field
            %td= f.label 'Title'
            %td= f.text_field :title
        %tr
          .field
            %td= f.label 'Authors'
            %td= render partial: 'authors', locals: {:authors => @authors}
        %tr
          .field
            %td= f.label 'Table of Contents markdown'
            %td= f.text_area :toc_body, rows:20, cols: 40, id: 'toc_area'
        %tr
          .field
            %td= f.label :comments
            %td= f.text_area :comments
        %tr
          .actions
            %td= f.submit 'Save'
  - if @toc.persisted? && !@toc.empty?
    #ocr{ class: 'col-xs-5'}
      = form_tag({action: 'do_ocr'}, {remote: true, id: 'ocr_form'}) do
        = hidden_field_tag :toc_id, @toc.id
        %table{class: 'table'}
          %tr
            .field
              %td= label_tag 'URLs of ToC page images'
              %td
                = text_area_tag :ocr_images, @toc.toc_page_urls
                - if @toc.toc_page_urls.present?
                  %small.text-muted
                    Pre-filled with marked TOC pages. Clear to enter different URLs.
          %tr
            .actions
              %td
                = submit_tag 'Attempt OCR', id: 'ocr_submit'
                #ocr_working.text-muted{style: 'display:none; margin-top: 10px;'}
                  %em Processing OCR, please wait...
          %tr
            %td
              #results
          %tr
            %td
              = button_tag(type: 'button', id: 'paste_ocr') do
                = '<-- paste to ToC textarea'
      :javascript
        $('#paste_ocr').click(function() {
          $('#toc_area').html($('#results').html());
        });

        $('#ocr_form').on('ajax:before', function() {
          $('#ocr_submit').prop('disabled', true);
          $('#ocr_working').show();
          $('#results').html('');
        });
  - elsif @toc.persisted? && @toc.empty?
    #browse_scans_prompt{ class: 'col-xs-5'}
      .alert.alert-info
        %p
          %strong No TOC pages marked yet.
        %p
          = link_to 'Browse Scans to Mark TOC Pages', browse_scans_toc_path(@toc), class: 'btn btn-primary btn-lg'
        %p.text-muted
          Once you mark the pages containing the table of contents, you can return here to use OCR.

%p#notice= notice

%p
  %b= t('tocs.show.book_title_and_uri')
  = "#{@toc.title} - #{@toc.book_uri}"
%p
  %b= t('common.labels.status')
  = @toc.status

- if @toc.pages_marked?
  .alert.alert-info
    %p
      %strong= t('tocs.show.pages_marked_alert.title')
      = t('tocs.show.pages_marked_alert.description')
    %p
      = link_to t('tocs.show.pages_marked_alert.edit_button'), edit_toc_path(@toc), class: 'btn btn-primary'
      = button_to t('tocs.show.pages_marked_alert.mark_transcribed_button'), mark_transcribed_toc_path(@toc), method: :post, class: 'btn btn-success', data: { confirm: t('tocs.show.pages_marked_alert.confirm_transcribed') }

- elsif @toc.transcribed?
  .alert.alert-success
    %p
      %strong= t('tocs.show.transcribed_alert.title')
      = t('tocs.show.transcribed_alert.description')
    %p
      = button_to t('tocs.show.transcribed_alert.verify_button'), verify_toc_path(@toc), method: :post, class: 'btn btn-success', data: { confirm: t('tocs.show.transcribed_alert.confirm_verified') }

- if @toc.no_explicit_toc
  %p
    %b= t('tocs.show.no_explicit_toc')
- elsif @toc.empty?
  .alert.alert-warning
    %p
      %strong= t('tocs.show.empty_alert.title')
      = t('tocs.show.empty_alert.description')
    %p
      = link_to t('tocs.show.empty_alert.browse_scans_button'), browse_scans_toc_path(@toc), class: 'btn btn-primary btn-lg'

.row
  .col-md-8
    - if @toc.toc_body.present?
      %p
        %b= t('tocs.show.toc_body')
      .toc-preview
        = toc_markdown_to_html_preview(@toc.toc_body)

  - if @toc.toc_page_urls.present?
    .col-md-4
      %p
        %b= t('tocs.show.marked_toc_pages')
        = "(#{@toc.toc_page_urls.split("\n").count})"
      .toc-page-thumbnails
        - @toc.toc_page_urls.split("\n").each_with_index do |url, index|
          .toc-page-thumb.mb-2
            = link_to url, target: '_blank' do
              = image_tag "#{url}?scale=8", alt: t('tocs.show.page_number', number: index + 1), class: 'img-thumbnail'
            .text-center.small
              = t('tocs.show.page_number', number: index + 1)
- if current_user&.admin?
  %p
    %b= t('common.labels.contributor')
    = @toc.contributor&.name || @toc.contributor_id
  %p
    %b= t('common.labels.reviewer')
    = @toc.reviewer&.name || @toc.reviewer_id
%p
  %b= t('common.labels.comments')
  = @toc.comments
%hr
- if @manifestation
  = render partial: 'manifestations/show', locals: { manifestation: @manifestation }
- unless @toc.empty?
  = link_to t('tocs.show.browse_scans_link'), browse_scans_toc_path(@toc), class: 'btn btn-info'
= link_to t('common.actions.edit'), edit_toc_path(@toc)
\|
= link_to t('common.actions.back'), tocs_path

:css
  .toc-page-thumbnails {
    max-height: 600px;
    overflow-y: auto;
  }
  .toc-page-thumb img {
    max-width: 100%;
    height: auto;
    cursor: pointer;
    transition: transform 0.2s;
  }
  .toc-page-thumb img:hover {
    transform: scale(1.05);
  }
  .toc-page-thumb {
    border: 1px solid #dee2e6;
    padding: 8px;
    border-radius: 4px;
    background-color: #f8f9fa;
  }
  .toc-preview {
    border: 1px solid #dee2e6;
    padding: 15px;
    border-radius: 4px;
    background-color: #fff;
  }
  .toc-preview h1 {
    font-size: 1.5em;
    margin: 10px 0;
    font-weight: bold;
  }
  .toc-preview h2 {
    font-size: 1.2em;
    margin: 8px 0 8px 20px;
    font-weight: normal;
  }
  .toc-preview .toc-section {
    color: #6c757d;
    font-style: italic;
  }
  .toc-preview .toc-author {
    color: #6c757d;
    font-size: 0.9em;
    font-weight: normal;
    margin-left: 10px;
  }
  .toc-preview .toc-author:before {
    content: "â€” ";
  }
